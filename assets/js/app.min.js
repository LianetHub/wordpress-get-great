(() => { "use strict"; if ($(".preloader").length > 0) { let e = setInterval(function () { let t = $("#percentage"), s = parseInt(t.text()); s < 90 ? t.text(++s) : s < 95 && "interactive" === document.readyState ? t.text(95) : s < 99 && "complete" === document.readyState && t.text(99), s >= 99 && "complete" === document.readyState && (clearInterval(e), t.text(100), setTimeout(function () { $("body").removeClass("preloading").addClass("is-loaded") }, 300)) }, 20) } $(function () { $('a[href^="#"]').not("[data-fancybox]").on("click", function (e) { const t = this.getAttribute("href"); if ("#" === t) return; const s = $(t), o = $(".header"); if (s.length) { e.preventDefault(); const t = o.outerHeight() || 0, n = s.offset().top - t; $("html, body").stop().animate({ scrollTop: n }, 800) } }), "undefined" != typeof Fancybox && null !== Fancybox && Fancybox.bind("[data-fancybox]", { dragToClose: !1, on: { ready: e => { const t = e.getSlide(); if ("#policies" === t.src) { const e = $(t.el), s = t.triggerEl; if (s) { const t = s.getAttribute("href").replace("#", ""), o = e.find(`input[name="policy-type"][value="${t}"]`); o.length ? o.prop("checked", !0).trigger("change") : e.find('input[name="policy-type"]:checked').trigger("change"), setTimeout(() => { o.length ? o.prop("checked", !0).trigger("change") : e.find('input[name="policy-type"]:checked').trigger("change") }, 300) } } }, close: (e, t) => { const s = t.target; if (s && s.hasAttribute("data-goto-catalog")) { const e = $("#catalog"), t = $(".header"); if (e.length) { const s = t.outerHeight() || 0, o = e.offset().top - s; $("html, body").stop().animate({ scrollTop: o }, 800) } } }, destroy: e => { "#cart" === e.getSlide().src && window?.dornottCart.resetInterface() } } }); const e = { Android: () => /Android/i.test(navigator.userAgent), BlackBerry: () => /BlackBerry/i.test(navigator.userAgent), iOS: () => /iPhone|iPad|iPod/i.test(navigator.userAgent), Opera: () => /Opera Mini/i.test(navigator.userAgent), Windows: () => /IEMobile/i.test(navigator.userAgent), any: function () { return this.Android() || this.BlackBerry() || this.iOS() || this.Opera() || this.Windows() } }; function t() { e.any() || $(window).width() < 992 ? $("body").removeClass("_pc").addClass("_touch") : $("body").removeClass("_touch").addClass("_pc") } function s() { const e = $(".steps__item"); e.off("click mouseenter mouseleave"), $("body").hasClass("_pc") ? e.on("mouseenter", function () { $(this).addClass("active").siblings().removeClass("active") }) : e.on("click", function (e) { $(this).addClass("active").siblings().removeClass("active") }) } t(), s(), $(window).on("resize", () => { clearTimeout(window.resizeTimer), window.resizeTimer = setTimeout(() => { t(), s() }, 100) }), $(document).on("click", e => { const t = $(e.target); if (t.closest(".menu__arrow").length) { const e = t.closest(".menu__arrow").parent(); e.hasClass("active") ? e.removeClass("active") : ($(".menu__item.active").removeClass("active"), e.addClass("active")) } if (t.closest(".menu__arrow").length || t.closest(".menu").length || $(".menu__item.active").removeClass("active"), t.closest(".menu").length || t.closest(".icon-menu").length || $(".menu__item.active").removeClass("active"), t.closest(".icon-menu").length && ($(".icon-menu").toggleClass("active"), $(".menu").toggleClass("menu--open"), $("body").toggleClass("menu-lock")), !$(".menu").hasClass("menu--open") || t.closest(".menu").length || t.closest(".icon-menu").length || ($(".icon-menu").removeClass("active"), $(".menu").removeClass("menu--open"), $("body").removeClass("menu-lock")), $(".menu").hasClass("menu--open") && t.closest(".menu__link").length && ($(".icon-menu").removeClass("active"), $(".menu").removeClass("menu--open"), $("body").removeClass("menu-lock")), t.closest(".favorite-btn").length && t.closest(".favorite-btn").toggleClass("active"), t.closest(".about__tab").length) { const e = t.closest(".about__tab"), s = e.index(), o = e.closest(".about"); o.find(".about__tab").removeClass("active"), e.addClass("active"), o.find(".about__tab-content").removeClass("active").eq(s).addClass("active"), o.find(".about__image").removeClass("active").eq(s).addClass("active") } }); var o = document.querySelectorAll('input[type="tel"]'), n = function (e) { return e.value.replace(/\D/g, "") }, a = function (e) { var t = e.target, s = n(t), o = e.clipboardData || window.clipboardData; if (o) { var a = o.getData("Text"); if (/\D/g.test(a)) return void (t.value = s) } }, i = function (e) { var t = e.target, s = n(t), o = t.selectionStart, a = ""; if (!s) return t.value = ""; if (t.value.length == o) { if (["7", "8", "9"].indexOf(s[0]) > -1) { "9" == s[0] && (s = "7" + s); var i = "8" == s[0] ? "8" : "+7"; a = t.value = i + " ", s.length > 1 && (a += "(" + s.substring(1, 4)), s.length >= 5 && (a += ") " + s.substring(4, 7)), s.length >= 8 && (a += "-" + s.substring(7, 9)), s.length >= 10 && (a += "-" + s.substring(9, 11)) } else a = "+" + s.substring(0, 16); t.value = a } else e.data && /\D/g.test(e.data) && (t.value = s) }, r = function (e) { var t = e.target.value.replace(/\D/g, ""); 8 == e.keyCode && 1 == t.length && (e.target.value = "") }; for (var l of o) l.addEventListener("keydown", r), l.addEventListener("input", i, !1), l.addEventListener("paste", a, !1); if ($(".promo__slider").length) { const e = $(".promo__tab-btn"), t = $(".promo"), s = $(".js-slide-source"), o = t.data("initial") || 0, n = e => { const t = e.slides[e.realIndex], o = $(t).attr("data-title") || "Слайд " + (e.realIndex + 1); s.val(o) }, a = new Swiper(".promo__slider", { initialSlide: o, slidesPerView: 1, effect: "fade", fadeEffect: { crossFade: !0 }, speed: 800, autoplay: { delay: 15e3, disableOnInteraction: !1, stopOnLastSlide: !1 }, on: { init: function (t) { let s = t.params.autoplay.delay; e.css("--counting-speed", s / 1e3 + "s"), e.each(function () { const e = $(this).find("rect")[0]; if (e) { const t = e.getTotalLength(); e.style.strokeDasharray = t, e.style.strokeDashoffset = t, e.style.transition = "none" } }), e.removeClass("active counting"), n(t), requestAnimationFrame(() => { requestAnimationFrame(() => { const s = t.realIndex, o = e.eq(s), n = o.find("rect")[0]; n && (o[0].offsetWidth, n.style.transition = ""), o.addClass("active counting") }) }) }, slideChangeTransitionStart: function (t) { const s = t.realIndex; let o = t.params.autoplay.delay, a = t.params.speed; if (e.css("--counting-speed", (o + a) / 1e3 + "s"), n(t), e.each(function () { const e = $(this).find("rect")[0]; if (e) { const t = e.getTotalLength(); $(this).removeClass("active counting"), e.style.transition = "none", e.style.strokeDashoffset = t } }), t.autoplay.running) { e[s].offsetWidth; const t = e.eq(s).find("rect")[0]; t && (t.style.transition = ""), e.eq(s).addClass("active counting") } else e.eq(s).addClass("active") } } }); e.on("click", function (t) { t.preventDefault(), a.autoplay.stop(), e.removeClass("counting"); const s = $(this).index(); a.slideTo(s) }) } $(".gratitudes__slider").length && new Swiper(".gratitudes__slider", { slidesPerView: 3, spaceBetween: 32, navigation: { nextEl: ".gratitudes__next", prevEl: ".gratitudes__prev" }, pagination: { el: ".gratitudes__pagination", type: "fraction", formatFractionCurrent: function (e) { return e < 10 ? "0" + e : e }, formatFractionTotal: function (e) { return e < 10 ? "0" + e : e }, renderFraction: function (e, t) { return '<span class="' + e + '"></span> / <span class="' + t + '"></span>' } }, breakpoints: { 1199.98: { slidesPerView: 4 }, 1709.98: { slidesPerView: 5 } } }), document.querySelectorAll(".marquee__slider").forEach(function (e) { var t = "reverse" === e.getAttribute("data-direction"), s = $(e).hasClass("marquee__slider--images"); new Swiper(e, { loop: !0, slidesPerView: "auto", observer: !0, observeParents: !0, freeMode: !0, allowTouchMove: !1, spaceBetween: s ? 64 : 12, speed: 24e3, autoplay: { delay: 1, disableOnInteraction: !1, reverseDirection: t } }) }); const c = $(".header"); new IntersectionObserver(function (e, t) { e[0].isIntersecting ? c.removeClass("scroll") : c.addClass("scroll") }).observe(c[0]), $(".switcher").each(function () { var e, t = $(this), s = $('<div class="switcher__slider"></div>'); function o(e) { if (t.is(":visible")) { var s = e.next(".switcher__btn"); if (s.length) { var o = s.outerWidth(), n = s.offset().left - t.offset().left - parseFloat(t.css("padding-left")); t.css("--active-width", o + "px"), t.css("--active-offset", n + "px") } } } t.prepend(s), new ResizeObserver(function (e) { for (var s of e) if (s.contentRect.width > 0 || s.contentRect.height > 0) { var n = t.find(".switcher__input:checked"); n.length && o(n) } }).observe(t[0]), t.on("change", ".switcher__input", function () { o($(this)) }), $(window).on("resize", function () { clearTimeout(e), e = setTimeout(function () { var e = t.find(".switcher__input:checked"); e.length && o(e) }, 150) }) }); var d = !1; $(window).scroll(function () { let e = $("#map"); if (!d && e.length > 0) { let t = document.createElement("script"); t.async = !0, t.defer = !0, t.src = "https://api-maps.yandex.ru/2.1/?lang=ru_RU"; let s = e.offset().top - $(window).height() - 200; $(this).scrollTop() > s && (document.head.append(t), t.onload = function () { !function () { const e = $("#map"); for (var t = e.data("coords").split("; "), s = e.data("placemark-logo"), o = 0; o < t.length; o++) { t[o] = t[o].split(", "); for (var n = 0; n < t[o].length; n++)t[o][n] = parseFloat(t[o][n]) } var a = t[0].map(function (e) { return e }); ymaps.ready(function () { var e = new ymaps.Map("map", { center: a, zoom: 16, controls: [] }), o = new ymaps.Placemark(t[0], {}, { iconLayout: "default#image", iconImageHref: s, iconImageSize: [69, 78], iconImageOffset: [-35, -78] }), n = new ymaps.control.ZoomControl({ options: { position: { right: 10, top: 200 } } }); e.behaviors.disable("scrollZoom"), e.controls.add(n), e.geoObjects.add(o) }) }() }, d = !0) } }), window.formController = new class { constructor() { this.selectors = { field: ".form__field", errorClass: "_error", loadingClass: "_loading", requiredAttr: "[data-required]", fileInput: ".form__file-input", fileContainer: ".form__file", fileRemove: ".form__file-remove", submitBtn: '[type="submit"]' }, this.init() } init() { const e = this; $("form").each(function () { e.bindSubmit($(this)) }), $(document).on("input change", this.selectors.requiredAttr, e => { const t = $(e.target); (t.hasClass(this.selectors.errorClass) || t.closest(this.selectors.field).hasClass(this.selectors.errorClass)) && this.toggleErrorState(t, !0) }), $(document).on("keydown", 'input[type="tel"]', e => this.onPhoneKeyDown(e)), $(document).on("input", 'input[type="tel"]', e => this.onPhoneInput(e)), $(document).on("paste", 'input[type="tel"]', e => this.onPhonePaste(e)), $(document).on("focus", 'input[type="tel"]', e => { e.target.value || (e.target.value = "+7 ") }), $(document).off("change", this.selectors.fileInput).on("change", this.selectors.fileInput, e => this.handleFileChange(e)), $(document).off("click", this.selectors.fileRemove).on("click", this.selectors.fileRemove, e => this.handleFileRemove(e)) } bindSubmit(e) { e.on("submit", async t => { "cart-form" !== e.attr("id") && (t.preventDefault(), this.validateForm(e) && await this.sendForm(e)) }) } async sendForm(e, t = !1) { console.log("submit from form controller"); const s = e.attr("action"), o = e.attr("method") || "POST", n = new FormData(e[0]), a = e.find(this.selectors.submitBtn); a.addClass(this.selectors.loadingClass); try { const a = await fetch(s, { method: o, body: n }); if (a.ok) { const s = await a.json(); if (s.success) { if (e[0].reset(), e.find(".form__file-preview").remove(), e.find(".uploaded").removeClass("uploaded"), window.dornottCart && "cart-form" === e.attr("id") && (localStorage.removeItem(window.dornottCart.storageKey), window.dornottCart.updateInterface()), !t) { const e = Fancybox.getInstance(); e && e.destroy(), Fancybox.show([{ src: "#success-submitting", type: "inline" }]), "function" == typeof ym && ym(105964434, "reachGoal", "sendmail") } } else console.error("Ошибка логики сервера:", s.data.message), this.showErrorPopup() } else console.error("Ошибка сервера (HTTP статус)"), this.showErrorPopup() } catch (e) { console.error("Ошибка сети", e), this.showErrorPopup() } finally { a.removeClass(this.selectors.loadingClass) } } showErrorPopup() { const e = Fancybox.getInstance(); e && e.destroy(), Fancybox.show([{ src: "#error-submitting", type: "inline" }]) } validateField(e) { if (!e.is(":visible")) return this.toggleErrorState(e, !0), !0; const t = e.attr("type"), s = e.attr("name"), o = e.val() ? e.val().trim() : ""; let n = !0; return n = "checkbox" === t ? e.is(":checked") : "username" === s ? /^[^\d]+$/.test(o) && o.length > 1 : "tel" === t ? o.replace(/\D/g, "").length >= 11 : "email" === t ? /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o) : "city" === s ? o.length >= 2 : "address" === s ? o.length >= 5 : "" !== o, this.toggleErrorState(e, n), n } toggleErrorState(e, t) { e.closest(this.selectors.field).toggleClass(this.selectors.errorClass, !t), e.toggleClass(this.selectors.errorClass, !t) } validateForm(e) { let t = !0; const s = this; return e.find(this.selectors.requiredAttr).each(function () { s.validateField($(this)) || (t = !1) }), t } handleFileChange(e) { const t = $(e.currentTarget).closest(this.selectors.fileContainer), s = e.target.files[0]; if (t.find(".form__file-preview").remove(), t.removeClass("uploaded"), s) { const e = s.type.match("image.*"), o = new FileReader; o.onload = o => { let n = ""; e && (n = `\n                        <span class="form__file-image">\n                            <img src="${o.target.result}" alt="Превью" class="cover-image">\n                        </span>\n                    `); const a = `\n                    <div class="form__file-preview">\n                        ${n}\n                        <span class="form__file-name">${s.name}</span>\n                        <button type="button" aria-label="Удалить" class="form__file-remove icon-cross"></button>\n                    </div>\n                `; t.append(a), t.addClass("uploaded") }, o.readAsDataURL(s) } } handleFileRemove(e) { e.preventDefault(), e.stopPropagation(); const t = $(e.currentTarget), s = t.closest(this.selectors.fileContainer), o = t.closest(".form__file-preview"); s.find(this.selectors.fileInput).val(""), s.removeClass("uploaded"), o.remove() } onPhoneInput(e) { const t = e.target; let s = t.value.replace(/\D/g, ""); const o = t.selectionStart; let n = ""; if (!s) return t.value = ""; t.value.length == o ? (s.length > 11 && (s = s.substring(0, 11)), n = "+7 (", s.length >= 2 && (n += s.substring(1, 4)), s.length >= 5 && (n += ") " + s.substring(4, 7)), s.length >= 8 && (n += "-" + s.substring(7, 9)), s.length >= 10 && (n += "-" + s.substring(9, 11)), t.value = n) : e.originalEvent.data && /\D/g.test(e.originalEvent.data) && (t.value = s) } onPhoneKeyDown(e) { const t = e.target.value.replace(/\D/g, ""); 8 == e.keyCode && 1 == t.length && (e.target.value = "") } onPhonePaste(e) { const t = e.target, s = t.value.replace(/\D/g, ""), o = e.originalEvent.clipboardData || window.clipboardData; if (o) { const e = o.getData("Text"); /\D/g.test(e) && (t.value = s) } } }, window.spollers = new class { constructor() { this.$spollersArray = $("[data-spollers]"), this.$spollersArray.length > 0 && this.init() } init() { const e = this.$spollersArray.filter((e, t) => !$(t).data("spollers").split(",")[0]); e.length > 0 && this.initSpollers(e); const t = this.$spollersArray.filter((e, t) => $(t).data("spollers").split(",")[0]); t.length > 0 && this.initMediaSpollers(t) } initMediaSpollers(e) { const t = []; e.each(function () { const e = $(this).data("spollers").split(","); t.push({ value: e[0], type: e[1] ? e[1].trim() : "max", item: $(this) }) }); let s = t.map(e => `(${e.type}-width: ${e.value}px),${e.value},${e.type}`); s = [...new Set(s)], s.forEach(e => { const s = e.split(","), o = s[1], n = s[2], a = window.matchMedia(s[0]), i = t.filter(e => e.value === o && e.type === n); a.addEventListener("change", () => { this.initSpollers(i, a) }), this.initSpollers(i, a) }) } initSpollers(e, t = !1) { (Array.isArray(e) ? e : e.toArray()).forEach(e => { const s = t ? e.item : $(e); !t || t.matches ? (s.addClass("_init"), this.initSpollerBody(s, !0), s.off("click", "[data-spoller]").on("click", "[data-spoller]", e => this.setSpollerAction(e))) : (s.removeClass("_init"), this.initSpollerBody(s, !1), s.off("click", "[data-spoller]")) }) } initSpollerBody(e, t = !0) { const s = e.find("[data-spoller]"); s.length > 0 && s.each(function () { const e = $(this), s = e.next(), o = e.parent(); t ? (e.removeAttr("tabindex"), e.hasClass("_active") ? o.addClass("_spoller-open") : (s.hide(), o.removeClass("_spoller-open"))) : (e.attr("tabindex", "-1"), s.show(), o.removeClass("_spoller-open")) }) } setSpollerAction(e) { const t = $(e.target), s = t.has("[data-spoller]") ? t : t.closest("[data-spoller]"), o = s.closest("[data-spollers]"), n = o.is("[data-one-spoller]"), a = s.next(), i = s.parent(); o.find(":animated").length || (n && !s.hasClass("_active") && this.hideSpollersBody(o), s.toggleClass("_active"), i.toggleClass("_spoller-open"), a.slideToggle(300)), e.preventDefault() } hideSpollersBody(e) { const t = e.find("[data-spoller]._active"); t.length && (t.removeClass("_active"), t.parent().removeClass("_spoller-open"), t.next().slideUp(300)) } } }) })();