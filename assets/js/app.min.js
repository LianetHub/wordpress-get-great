(() => { "use strict"; if ($(".preloader").length > 0) { let e = setInterval(function () { let t = $("#percentage"), n = parseInt(t.text()); n < 90 ? t.text(++n) : n < 95 && "interactive" === document.readyState ? t.text(95) : n < 99 && "complete" === document.readyState && t.text(99), n >= 99 && "complete" === document.readyState && (clearInterval(e), t.text(100), setTimeout(function () { $("body").removeClass("preloading").addClass("is-loaded") }, 300)) }, 20) } $(function () { $('a[href^="#"]').not("[data-fancybox]").on("click", function (e) { const t = this.getAttribute("href"); if ("#" === t) return; const n = $(t), o = $(".header"); if (n.length) { e.preventDefault(); const t = o.outerHeight() || 0, s = n.offset().top - t; $("html, body").stop().animate({ scrollTop: s }, 800) } }), "undefined" != typeof Fancybox && null !== Fancybox && Fancybox.bind("[data-fancybox]", { dragToClose: !1, on: { ready: e => { const t = e.getSlide(); if ("#policies" === t.src) { const e = $(t.el), n = t.triggerEl; if (n) { const t = n.getAttribute("href").replace("#", ""), o = e.find(`input[name="policy-type"][value="${t}"]`); o.length ? o.prop("checked", !0).trigger("change") : e.find('input[name="policy-type"]:checked').trigger("change"), setTimeout(() => { o.length ? o.prop("checked", !0).trigger("change") : e.find('input[name="policy-type"]:checked').trigger("change") }, 300) } } }, close: (e, t) => { const n = t.target; if (n && n.hasAttribute("data-goto-catalog")) { const e = $("#catalog"), t = $(".header"); if (e.length) { const n = t.outerHeight() || 0, o = e.offset().top - n; $("html, body").stop().animate({ scrollTop: o }, 800) } } }, destroy: e => { "#cart" === e.getSlide().src && window?.dornottCart.resetInterface() } } }); const e = { Android: () => /Android/i.test(navigator.userAgent), BlackBerry: () => /BlackBerry/i.test(navigator.userAgent), iOS: () => /iPhone|iPad|iPod/i.test(navigator.userAgent), Opera: () => /Opera Mini/i.test(navigator.userAgent), Windows: () => /IEMobile/i.test(navigator.userAgent), any: function () { return this.Android() || this.BlackBerry() || this.iOS() || this.Opera() || this.Windows() } }; function t() { e.any() || $(window).width() < 992 ? $("body").removeClass("_pc").addClass("_touch") : $("body").removeClass("_touch").addClass("_pc") } function n() { const e = $(".steps__item"); e.off("click mouseenter mouseleave"), $("body").hasClass("_pc") ? e.on("mouseenter", function () { $(this).addClass("active").siblings().removeClass("active") }) : e.on("click", function (e) { $(this).addClass("active").siblings().removeClass("active") }) } t(), n(), $(window).on("resize", () => { clearTimeout(window.resizeTimer), window.resizeTimer = setTimeout(() => { t(), n() }, 100) }), $(document).on("click", e => { const t = $(e.target); if (t.closest(".menu__arrow").length) { const e = t.closest(".menu__arrow").parent(); e.hasClass("active") ? e.removeClass("active") : ($(".menu__item.active").removeClass("active"), e.addClass("active")) } t.closest(".menu__arrow").length || t.closest(".menu").length || $(".menu__item.active").removeClass("active"), t.closest(".menu").length || t.closest(".icon-menu").length || $(".menu__item.active").removeClass("active"), t.closest(".icon-menu").length && ($(".icon-menu").toggleClass("active"), $(".menu").toggleClass("menu--open"), $("body").toggleClass("menu-lock")), !$(".menu").hasClass("menu--open") || t.closest(".menu").length || t.closest(".icon-menu").length || ($(".icon-menu").removeClass("active"), $(".menu").removeClass("menu--open"), $("body").removeClass("menu-lock")), $(".menu").hasClass("menu--open") && t.closest(".menu__link").length && ($(".icon-menu").removeClass("active"), $(".menu").removeClass("menu--open"), $("body").removeClass("menu-lock")), t.closest(".favorite-btn").length && t.closest(".favorite-btn").toggleClass("active") }); var o = document.querySelectorAll('input[type="tel"]'), s = function (e) { return e.value.replace(/\D/g, "") }, a = function (e) { var t = e.target, n = s(t), o = e.clipboardData || window.clipboardData; if (o) { var a = o.getData("Text"); if (/\D/g.test(a)) return void (t.value = n) } }, i = function (e) { var t = e.target, n = s(t), o = t.selectionStart, a = ""; if (!n) return t.value = ""; if (t.value.length == o) { if (["7", "8", "9"].indexOf(n[0]) > -1) { "9" == n[0] && (n = "7" + n); var i = "8" == n[0] ? "8" : "+7"; a = t.value = i + " ", n.length > 1 && (a += "(" + n.substring(1, 4)), n.length >= 5 && (a += ") " + n.substring(4, 7)), n.length >= 8 && (a += "-" + n.substring(7, 9)), n.length >= 10 && (a += "-" + n.substring(9, 11)) } else a = "+" + n.substring(0, 16); t.value = a } else e.data && /\D/g.test(e.data) && (t.value = n) }, r = function (e) { var t = e.target.value.replace(/\D/g, ""); 8 == e.keyCode && 1 == t.length && (e.target.value = "") }; for (var l of o) l.addEventListener("keydown", r), l.addEventListener("input", i, !1), l.addEventListener("paste", a, !1); if ($(".promo__slider").length) { const e = $(".promo__tab-btn"), t = $(".promo").data("initial") || 0, n = new Swiper(".promo__slider", { initialSlide: t, slidesPerView: 1, effect: "fade", fadeEffect: { crossFade: !0 }, speed: 800, autoplay: { delay: 15e3, disableOnInteraction: !1, stopOnLastSlide: !1 }, on: { init: function (t) { let n = t.params.autoplay.delay / 1e3 + "s"; e.css("--counting-speed", n), e.each(function () { const e = $(this).find("rect")[0]; if (e) { const t = e.getTotalLength(); e.style.strokeDasharray = t, e.style.strokeDashoffset = t } }); const o = t.realIndex; e.eq(o).addClass("active counting") }, slideChangeTransitionStart: function (t) { const n = t.realIndex; e.each(function () { const e = $(this).find("rect")[0]; if (e) { const t = e.getTotalLength(); $(this).removeClass("active counting"), e.style.transition = "none", e.style.strokeDashoffset = t } }), e[n].offsetWidth; const o = e.eq(n).find("rect")[0]; o && (o.style.transition = ""), e.eq(n).addClass("active counting") }, autoplayStop: function () { e.removeClass("counting") }, autoplayStart: function () { e.filter(".active").addClass("counting") } } }); e.on("click", function (e) { e.preventDefault(), n.slideTo($(this).index()), n.autoplay.running && n.autoplay.start() }) } const c = $(".header"); new IntersectionObserver(function (e, t) { e[0].isIntersecting ? c.removeClass("scroll") : c.addClass("scroll") }).observe(c[0]), $(".switcher").each(function () { var e, t = $(this), n = $('<div class="switcher__slider"></div>'); function o(e) { if (t.is(":visible")) { var n = e.next(".switcher__btn"); if (n.length) { var o = n.outerWidth(), s = n.offset().left - t.offset().left - parseFloat(t.css("padding-left")); t.css("--active-width", o + "px"), t.css("--active-offset", s + "px") } } } t.prepend(n), new ResizeObserver(function (e) { for (var n of e) if (n.contentRect.width > 0 || n.contentRect.height > 0) { var s = t.find(".switcher__input:checked"); s.length && o(s) } }).observe(t[0]), t.on("change", ".switcher__input", function () { o($(this)) }), $(window).on("resize", function () { clearTimeout(e), e = setTimeout(function () { var e = t.find(".switcher__input:checked"); e.length && o(e) }, 150) }) }); var d = !1; $(window).scroll(function () { let e = $("#map"); if (!d && e.length > 0) { let t = document.createElement("script"); t.async = !0, t.defer = !0, t.src = "https://api-maps.yandex.ru/2.1/?lang=ru_RU"; let n = e.offset().top - $(window).height() - 200; $(this).scrollTop() > n && (document.head.append(t), t.onload = function () { !function () { const e = $("#map"); for (var t = e.data("coords").split("; "), n = e.data("placemark-logo"), o = 0; o < t.length; o++) { t[o] = t[o].split(", "); for (var s = 0; s < t[o].length; s++)t[o][s] = parseFloat(t[o][s]) } var a = t[0].map(function (e) { return e }); ymaps.ready(function () { var e = new ymaps.Map("map", { center: a, zoom: 16, controls: [] }), o = new ymaps.Placemark(t[0], {}, { iconLayout: "default#image", iconImageHref: n, iconImageSize: [69, 78], iconImageOffset: [-35, -78] }), s = new ymaps.control.ZoomControl({ options: { position: { right: 10, top: 200 } } }); e.behaviors.disable("scrollZoom"), e.controls.add(s), e.geoObjects.add(o) }) }() }, d = !0) } }), window.formController = new class { constructor() { this.selectors = { field: ".form__field", errorClass: "_error", loadingClass: "_loading", requiredAttr: "[data-required]", fileInput: ".form__file-input", fileContainer: ".form__file", fileRemove: ".form__file-remove", submitBtn: '[type="submit"]' }, this.init() } init() { const e = this; $("form").each(function () { e.bindSubmit($(this)) }), $(document).on("input change", this.selectors.requiredAttr, e => { const t = $(e.target); (t.hasClass(this.selectors.errorClass) || t.closest(this.selectors.field).hasClass(this.selectors.errorClass)) && this.toggleErrorState(t, !0) }), $(document).on("keydown", 'input[type="tel"]', e => this.onPhoneKeyDown(e)), $(document).on("input", 'input[type="tel"]', e => this.onPhoneInput(e)), $(document).on("paste", 'input[type="tel"]', e => this.onPhonePaste(e)), $(document).on("focus", 'input[type="tel"]', e => { e.target.value || (e.target.value = "+7 ") }), $(document).off("change", this.selectors.fileInput).on("change", this.selectors.fileInput, e => this.handleFileChange(e)), $(document).off("click", this.selectors.fileRemove).on("click", this.selectors.fileRemove, e => this.handleFileRemove(e)) } bindSubmit(e) { e.on("submit", async t => { "cart-form" !== e.attr("id") && (t.preventDefault(), this.validateForm(e) && await this.sendForm(e)) }) } async sendForm(e, t = !1) { console.log("submit from form controller"); const n = e.attr("action"), o = e.attr("method") || "POST", s = new FormData(e[0]), a = e.find(this.selectors.submitBtn); a.addClass(this.selectors.loadingClass); try { const a = await fetch(n, { method: o, body: s }); if (a.ok) { const n = await a.json(); if (n.success) { if (e[0].reset(), e.find(".form__file-preview").remove(), e.find(".uploaded").removeClass("uploaded"), window.dornottCart && "cart-form" === e.attr("id") && (localStorage.removeItem(window.dornottCart.storageKey), window.dornottCart.updateInterface()), !t) { const e = Fancybox.getInstance(); e && e.destroy(), Fancybox.show([{ src: "#success-submitting", type: "inline" }]), "function" == typeof ym && ym(105964434, "reachGoal", "sendmail") } } else console.error("Ошибка логики сервера:", n.data.message), this.showErrorPopup() } else console.error("Ошибка сервера (HTTP статус)"), this.showErrorPopup() } catch (e) { console.error("Ошибка сети", e), this.showErrorPopup() } finally { a.removeClass(this.selectors.loadingClass) } } showErrorPopup() { const e = Fancybox.getInstance(); e && e.destroy(), Fancybox.show([{ src: "#error-submitting", type: "inline" }]) } validateField(e) { if (!e.is(":visible")) return this.toggleErrorState(e, !0), !0; const t = e.attr("type"), n = e.attr("name"), o = e.val() ? e.val().trim() : ""; let s = !0; return s = "checkbox" === t ? e.is(":checked") : "username" === n ? /^[^\d]+$/.test(o) && o.length > 1 : "tel" === t ? o.replace(/\D/g, "").length >= 11 : "email" === t ? /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o) : "city" === n ? o.length >= 2 : "address" === n ? o.length >= 5 : "" !== o, this.toggleErrorState(e, s), s } toggleErrorState(e, t) { e.closest(this.selectors.field).toggleClass(this.selectors.errorClass, !t), e.toggleClass(this.selectors.errorClass, !t) } validateForm(e) { let t = !0; const n = this; return e.find(this.selectors.requiredAttr).each(function () { n.validateField($(this)) || (t = !1) }), t } handleFileChange(e) { const t = $(e.currentTarget).closest(this.selectors.fileContainer), n = e.target.files[0]; if (t.find(".form__file-preview").remove(), t.removeClass("uploaded"), n) { const e = n.type.match("image.*"), o = new FileReader; o.onload = o => { let s = ""; e && (s = `\n                        <span class="form__file-image">\n                            <img src="${o.target.result}" alt="Превью" class="cover-image">\n                        </span>\n                    `); const a = `\n                    <div class="form__file-preview">\n                        ${s}\n                        <span class="form__file-name">${n.name}</span>\n                        <button type="button" aria-label="Удалить" class="form__file-remove icon-cross"></button>\n                    </div>\n                `; t.append(a), t.addClass("uploaded") }, o.readAsDataURL(n) } } handleFileRemove(e) { e.preventDefault(), e.stopPropagation(); const t = $(e.currentTarget), n = t.closest(this.selectors.fileContainer), o = t.closest(".form__file-preview"); n.find(this.selectors.fileInput).val(""), n.removeClass("uploaded"), o.remove() } onPhoneInput(e) { const t = e.target; let n = t.value.replace(/\D/g, ""); const o = t.selectionStart; let s = ""; if (!n) return t.value = ""; t.value.length == o ? (n.length > 11 && (n = n.substring(0, 11)), s = "+7 (", n.length >= 2 && (s += n.substring(1, 4)), n.length >= 5 && (s += ") " + n.substring(4, 7)), n.length >= 8 && (s += "-" + n.substring(7, 9)), n.length >= 10 && (s += "-" + n.substring(9, 11)), t.value = s) : e.originalEvent.data && /\D/g.test(e.originalEvent.data) && (t.value = n) } onPhoneKeyDown(e) { const t = e.target.value.replace(/\D/g, ""); 8 == e.keyCode && 1 == t.length && (e.target.value = "") } onPhonePaste(e) { const t = e.target, n = t.value.replace(/\D/g, ""), o = e.originalEvent.clipboardData || window.clipboardData; if (o) { const e = o.getData("Text"); /\D/g.test(e) && (t.value = n) } } } }) })();