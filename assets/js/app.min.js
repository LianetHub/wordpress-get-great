(() => { "use strict"; if ($(".preloader").length > 0) { let e = setInterval(function () { let t = $("#percentage"), s = parseInt(t.text()); s < 90 ? t.text(++s) : s < 95 && "interactive" === document.readyState ? t.text(95) : s < 99 && "complete" === document.readyState && t.text(99), s >= 99 && "complete" === document.readyState && (clearInterval(e), t.text(100), setTimeout(function () { $("body").removeClass("preloading").addClass("is-loaded") }, 300)) }, 20) } $(function () { $('a[href^="#"]').not("[data-fancybox]").on("click", function (e) { const t = this.getAttribute("href"); if ("#" === t) return; const s = $(t), n = $(".header"); if (s.length) { e.preventDefault(); const t = n.outerHeight() || 0, i = s.offset().top - t; $("html, body").stop().animate({ scrollTop: i }, 800) } }), "undefined" != typeof Fancybox && null !== Fancybox && Fancybox.bind("[data-fancybox]", { dragToClose: !1, on: { ready: e => { const t = e.getSlide(); if ("#policies" === t.src) { const e = $(t.el), s = t.triggerEl; if (s) { const t = s.getAttribute("href").replace("#", ""), n = e.find(`input[name="policy-type"][value="${t}"]`); n.length ? n.prop("checked", !0).trigger("change") : e.find('input[name="policy-type"]:checked').trigger("change"), setTimeout(() => { n.length ? n.prop("checked", !0).trigger("change") : e.find('input[name="policy-type"]:checked').trigger("change") }, 300) } } }, close: (e, t) => { const s = t.target; if (s && s.hasAttribute("data-goto-catalog")) { const e = $("#catalog"), t = $(".header"); if (e.length) { const s = t.outerHeight() || 0, n = e.offset().top - s; $("html, body").stop().animate({ scrollTop: n }, 800) } } }, destroy: e => { "#cart" === e.getSlide().src && window?.dornottCart.resetInterface() } } }); const e = { Android: () => /Android/i.test(navigator.userAgent), BlackBerry: () => /BlackBerry/i.test(navigator.userAgent), iOS: () => /iPhone|iPad|iPod/i.test(navigator.userAgent), Opera: () => /Opera Mini/i.test(navigator.userAgent), Windows: () => /IEMobile/i.test(navigator.userAgent), any: function () { return this.Android() || this.BlackBerry() || this.iOS() || this.Opera() || this.Windows() } }; function t() { e.any() || $(window).width() < 992 ? $("body").removeClass("_pc").addClass("_touch") : $("body").removeClass("_touch").addClass("_pc") } function s() { const e = $(".steps__item"); e.off("click mouseenter mouseleave"), $("body").hasClass("_pc") ? e.on("mouseenter", function () { $(this).addClass("active").siblings().removeClass("active") }) : e.on("click", function (e) { $(this).addClass("active").siblings().removeClass("active") }) } t(), s(), $(window).on("resize", () => { clearTimeout(window.resizeTimer), window.resizeTimer = setTimeout(() => { t(), s() }, 100) }), $(document).on("click", e => { const t = $(e.target); if (t.closest(".menu__arrow").length) { const e = t.closest(".menu__arrow").parent(); e.hasClass("active") ? e.removeClass("active") : ($(".menu__item.active").removeClass("active"), e.addClass("active")) } if (t.closest(".menu__arrow").length || t.closest(".menu").length || $(".menu__item.active").removeClass("active"), t.closest(".menu").length || t.closest(".icon-menu").length || $(".menu__item.active").removeClass("active"), t.closest(".icon-menu").length && ($(".icon-menu").toggleClass("active"), $(".menu").toggleClass("menu--open"), $("body").toggleClass("menu-lock")), !$(".menu").hasClass("menu--open") || t.closest(".menu").length || t.closest(".icon-menu").length || ($(".icon-menu").removeClass("active"), $(".menu").removeClass("menu--open"), $("body").removeClass("menu-lock")), $(".menu").hasClass("menu--open") && t.closest(".menu__link").length && ($(".icon-menu").removeClass("active"), $(".menu").removeClass("menu--open"), $("body").removeClass("menu-lock")), t.closest(".about__tab").length) { const e = t.closest(".about__tab"), s = e.index(), n = e.closest(".about"); n.find(".about__tab").removeClass("active"), e.addClass("active"), n.find(".about__tab-content").removeClass("active").eq(s).addClass("active"), n.find(".about__image").removeClass("active").eq(s).addClass("active") } if (t.closest(".services__item").length) { const e = t.closest(".services__item"), s = e.data("project-id"), n = e.closest(".services"); n.find(".services__item").removeClass("active"), e.addClass("active"), n.find(".services__project").removeClass("active"), n.find(`[data-project-target="${s}"]`).addClass("active") } }); if ($(".promo__slider").length) { const e = $(".promo__tab-btn"), t = $(".promo"), s = $(".js-slide-source"), n = t.data("initial") || 0, i = e => { const t = e.slides[e.realIndex], n = $(t).attr("data-title") || "Слайд " + (e.realIndex + 1); s.val(n) }, o = new Swiper(".promo__slider", { initialSlide: n, slidesPerView: 1, effect: "fade", fadeEffect: { crossFade: !0 }, speed: 800, autoplay: { delay: 15e3, disableOnInteraction: !1, stopOnLastSlide: !1 }, on: { init: function (t) { let s = t.params.autoplay.delay; e.css("--counting-speed", s / 1e3 + "s"), e.each(function () { const e = $(this).find("rect")[0]; if (e) { const t = e.getTotalLength(); e.style.strokeDasharray = t, e.style.strokeDashoffset = t, e.style.transition = "none" } }), e.removeClass("active counting"), i(t), requestAnimationFrame(() => { requestAnimationFrame(() => { const s = t.realIndex, n = e.eq(s), i = n.find("rect")[0]; i && (n[0].offsetWidth, i.style.transition = ""), n.addClass("active counting") }) }) }, slideChangeTransitionStart: function (t) { const s = t.realIndex; let n = t.params.autoplay.delay, o = t.params.speed; if (e.css("--counting-speed", (n + o) / 1e3 + "s"), i(t), e.each(function () { const e = $(this).find("rect")[0]; if (e) { const t = e.getTotalLength(); $(this).removeClass("active counting"), e.style.transition = "none", e.style.strokeDashoffset = t } }), t.autoplay.running) { e[s].offsetWidth; const t = e.eq(s).find("rect")[0]; t && (t.style.transition = ""), e.eq(s).addClass("active counting") } else e.eq(s).addClass("active") } } }); e.on("click", function (t) { t.preventDefault(), o.autoplay.stop(), e.removeClass("counting"); const s = $(this).index(); o.slideTo(s) }) } $(".gratitudes__slider").length && new Swiper(".gratitudes__slider", { slidesPerView: 2, spaceBetween: 32, navigation: { nextEl: ".gratitudes__next", prevEl: ".gratitudes__prev" }, pagination: { el: ".gratitudes__pagination", type: "fraction", formatFractionCurrent: function (e) { return e < 10 ? "0" + e : e }, formatFractionTotal: function (e) { return e < 10 ? "0" + e : e }, renderFraction: function (e, t) { return '<span class="' + e + '"></span> / <span class="' + t + '"></span>' } }, breakpoints: { 767.98: { slidesPerView: 3 }, 1199.98: { slidesPerView: 4 }, 1709.98: { slidesPerView: 5 } } }), document.querySelectorAll(".marquee__slider").forEach(function (e) { var t = "reverse" === e.getAttribute("data-direction"), s = $(e).hasClass("marquee__slider--images"); let n = 0, i = !1; var o = new Swiper(e, { loop: !0, slidesPerView: "auto", observer: !0, observeParents: !0, freeMode: !0, allowTouchMove: !0, spaceBetween: s ? 64 : 12, speed: 8e3, autoplay: { delay: 0, disableOnInteraction: !1, pauseOnMouseEnter: !1, reverseDirection: t } }); const a = () => { document.querySelectorAll(".tooltip-marquee").forEach(e => e.remove()) }, r = () => { if (i) return; const e = window.getComputedStyle(o.wrapperEl), t = new WebKitCSSMatrix(e.transform); n = t.m41, o.autoplay.stop(), o.wrapperEl.style.transition = "none", o.setTranslate(n), i = !0 }, l = () => { i && (o.wrapperEl.style.transition = "", o.params.freeMode.enabled = !1, o.update(), o.params.freeMode.enabled = !0, o.update(), o.setTranslate(n), o.autoplay.start(), i = !1) }, c = (e, t) => { const s = e.getAttribute("data-tooltip-content"); if (!s) return; a(), r(); const n = document.createElement("div"); n.className = "tooltip tooltip-marquee", n.innerHTML = s, document.body.appendChild(n); const i = e.getBoundingClientRect(), o = n.getBoundingClientRect(), l = window.scrollY || document.documentElement.scrollTop, c = window.scrollX || document.documentElement.scrollLeft; let d = i.bottom + l + 16, p = i.left + c + i.width / 2 - o.width / 2, h = "open-bottom"; d + o.height > l + window.innerHeight && (d = i.top + l - o.height - 16, h = "open-top"), n.classList.add(h), p < 10 && (p = 10), p + o.width > window.innerWidth - 10 && (p = window.innerWidth - o.width - 10), n.style.top = `${d}px`, n.style.left = `${p}px`, t.stopPropagation() }; e.addEventListener("pointerenter", e => { "mouse" === e.pointerType && r() }), e.addEventListener("pointerleave", e => { "mouse" === e.pointerType && (a(), l()) }), e.querySelectorAll(".marquee__image[data-tooltip-content]").forEach(e => { e.addEventListener("pointerenter", t => { "mouse" === t.pointerType && c(e, t) }), e.addEventListener("click", t => { r(), c(e, t) }) }), document.addEventListener("pointerdown", e => { e.target.closest(".marquee__image") || e.target.closest(".tooltip-marquee") || (a(), e.target.closest(".marquee__slider") || l()) }) }), $(".services__slider").length && new class { constructor(e, t, s = 767.98) { this.$slider = $(e), this.options = t, this.init = !1, this.swiper = null, this.condition = s, this.$slider.length && (this.handleResize(), $(window).on("resize", () => this.handleResize())) } handleResize() { window.innerWidth <= this.condition ? this.init || (this.init = !0, this.swiper = new Swiper(this.$slider[0], this.options)) : this.init && (this.swiper.destroy(), this.swiper = null, this.init = !1) } }(".services__slider", { slidesPerView: "auto", slideToClickedSlide: !0, spaceBetween: 12 }, 1199.98), window.formController = new class { constructor() { this.selectors = { field: ".form__field", errorClass: "_error", loadingClass: "_loading", requiredAttr: "[data-required]", fileInput: ".form__file-input", fileContainer: ".form__file", fileRemove: ".form__file-remove", submitBtn: '[type="submit"]' }, this.init() } init() { const e = this; $("form").each(function () { e.bindSubmit($(this)) }), $(document).on("input change", this.selectors.requiredAttr, e => { const t = $(e.target); (t.hasClass(this.selectors.errorClass) || t.closest(this.selectors.field).hasClass(this.selectors.errorClass)) && this.toggleErrorState(t, !0) }), $(document).on("keydown", 'input[type="tel"]', e => this.onPhoneKeyDown(e)), $(document).on("input", 'input[type="tel"]', e => this.onPhoneInput(e)), $(document).on("paste", 'input[type="tel"]', e => this.onPhonePaste(e)), $(document).on("focus", 'input[type="tel"]', e => { e.target.value || (e.target.value = "+7 ") }), $(document).off("change", this.selectors.fileInput).on("change", this.selectors.fileInput, e => this.handleFileChange(e)), $(document).off("click", this.selectors.fileRemove).on("click", this.selectors.fileRemove, e => this.handleFileRemove(e)) } bindSubmit(e) { e.on("submit", async t => { "cart-form" !== e.attr("id") && (t.preventDefault(), this.validateForm(e) && await this.sendForm(e)) }) } async sendForm(e, t = !1) { console.log("submit from form controller"); const s = e.attr("action"), n = e.attr("method") || "POST", i = new FormData(e[0]), o = e.find(this.selectors.submitBtn); o.addClass(this.selectors.loadingClass); try { const o = await fetch(s, { method: n, body: i }); if (o.ok) { const s = await o.json(); if (s.success) { if (e[0].reset(), e.find(".form__file-preview").remove(), e.find(".uploaded").removeClass("uploaded"), window.dornottCart && "cart-form" === e.attr("id") && (localStorage.removeItem(window.dornottCart.storageKey), window.dornottCart.updateInterface()), !t) { const e = Fancybox.getInstance(); e && e.destroy(), Fancybox.show([{ src: "#success-submitting", type: "inline" }]), "function" == typeof ym && ym(105964434, "reachGoal", "sendmail") } } else console.error("Ошибка логики сервера:", s.data.message), this.showErrorPopup() } else console.error("Ошибка сервера (HTTP статус)"), this.showErrorPopup() } catch (e) { console.error("Ошибка сети", e), this.showErrorPopup() } finally { o.removeClass(this.selectors.loadingClass) } } showErrorPopup() { const e = Fancybox.getInstance(); e && e.destroy(), Fancybox.show([{ src: "#error-submitting", type: "inline" }]) } validateField(e) { if (!e.is(":visible")) return this.toggleErrorState(e, !0), !0; const t = e.attr("type"), s = e.attr("name"), n = e.val() ? e.val().trim() : ""; let i = !0; return i = "checkbox" === t ? e.is(":checked") : "username" === s ? /^[^\d]+$/.test(n) && n.length > 1 : "tel" === t ? n.replace(/\D/g, "").length >= 11 : "email" === t ? /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n) : "city" === s ? n.length >= 2 : "address" === s ? n.length >= 5 : "" !== n, this.toggleErrorState(e, i), i } toggleErrorState(e, t) { e.closest(this.selectors.field).toggleClass(this.selectors.errorClass, !t), e.toggleClass(this.selectors.errorClass, !t) } validateForm(e) { let t = !0; const s = this; return e.find(this.selectors.requiredAttr).each(function () { s.validateField($(this)) || (t = !1) }), t } handleFileChange(e) { const t = $(e.currentTarget).closest(this.selectors.fileContainer), s = e.target.files[0]; if (t.find(".form__file-preview").remove(), t.removeClass("uploaded"), s) { const e = s.type.match("image.*"), n = new FileReader; n.onload = n => { let i = ""; e && (i = `\n                        <span class="form__file-image">\n                            <img src="${n.target.result}" alt="Превью" class="cover-image">\n                        </span>\n                    `); const o = `\n                    <div class="form__file-preview">\n                        ${i}\n                        <span class="form__file-name">${s.name}</span>\n                        <button type="button" aria-label="Удалить" class="form__file-remove icon-cross"></button>\n                    </div>\n                `; t.append(o), t.addClass("uploaded") }, n.readAsDataURL(s) } } handleFileRemove(e) { e.preventDefault(), e.stopPropagation(); const t = $(e.currentTarget), s = t.closest(this.selectors.fileContainer), n = t.closest(".form__file-preview"); s.find(this.selectors.fileInput).val(""), s.removeClass("uploaded"), n.remove() } onPhoneInput(e) { const t = e.target; let s = t.value.replace(/\D/g, ""); const n = t.selectionStart; let i = ""; if (!s) return t.value = ""; t.value.length == n ? (s.length > 11 && (s = s.substring(0, 11)), i = "+7 (", s.length >= 2 && (i += s.substring(1, 4)), s.length >= 5 && (i += ") " + s.substring(4, 7)), s.length >= 8 && (i += "-" + s.substring(7, 9)), s.length >= 10 && (i += "-" + s.substring(9, 11)), t.value = i) : e.originalEvent.data && /\D/g.test(e.originalEvent.data) && (t.value = s) } onPhoneKeyDown(e) { const t = e.target.value.replace(/\D/g, ""); 8 == e.keyCode && 1 == t.length && (e.target.value = "") } onPhonePaste(e) { const t = e.target, s = t.value.replace(/\D/g, ""), n = e.originalEvent.clipboardData || window.clipboardData; if (n) { const e = n.getData("Text"); /\D/g.test(e) && (t.value = s) } } }, window.spollers = new class { constructor() { this.$spollersArray = $("[data-spollers]"), this.$spollersArray.length > 0 && this.init() } init() { const e = this.$spollersArray.filter((e, t) => !$(t).data("spollers").split(",")[0]); e.length > 0 && this.initSpollers(e); const t = this.$spollersArray.filter((e, t) => $(t).data("spollers").split(",")[0]); t.length > 0 && this.initMediaSpollers(t) } initMediaSpollers(e) { const t = []; e.each(function () { const e = $(this).data("spollers").split(","); t.push({ value: e[0], type: e[1] ? e[1].trim() : "max", item: $(this) }) }); let s = t.map(e => `(${e.type}-width: ${e.value}px),${e.value},${e.type}`); s = [...new Set(s)], s.forEach(e => { const s = e.split(","), n = s[1], i = s[2], o = window.matchMedia(s[0]), a = t.filter(e => e.value === n && e.type === i); o.addEventListener("change", () => { this.initSpollers(a, o) }), this.initSpollers(a, o) }) } initSpollers(e, t = !1) { (Array.isArray(e) ? e : e.toArray()).forEach(e => { const s = t ? e.item : $(e); !t || t.matches ? (s.addClass("_init"), this.initSpollerBody(s, !0), s.off("click", "[data-spoller]").on("click", "[data-spoller]", e => this.setSpollerAction(e))) : (s.removeClass("_init"), this.initSpollerBody(s, !1), s.off("click", "[data-spoller]")) }) } initSpollerBody(e, t = !0) { const s = e.find("[data-spoller]"); s.length > 0 && s.each(function () { const e = $(this), s = e.next(), n = e.parent(); t ? (e.removeAttr("tabindex"), e.hasClass("_active") ? n.addClass("_spoller-open") : (s.hide(), n.removeClass("_spoller-open"))) : (e.attr("tabindex", "-1"), s.show(), n.removeClass("_spoller-open")) }) } setSpollerAction(e) { const t = $(e.target), s = t.has("[data-spoller]") ? t : t.closest("[data-spoller]"), n = s.closest("[data-spollers]"), i = n.is("[data-one-spoller]"), o = s.next(), a = s.parent(); n.find(":animated").length || (i && !s.hasClass("_active") && this.hideSpollersBody(n), s.toggleClass("_active"), a.toggleClass("_spoller-open"), o.slideToggle(300)), e.preventDefault() } hideSpollersBody(e) { const t = e.find("[data-spoller]._active"); t.length && (t.removeClass("_active"), t.parent().removeClass("_spoller-open"), t.next().slideUp(300)) } }, window.dynamicAdapt = new class { constructor(e) { this.type = e, this.objects = [], this.daClassname = "_dynamic_adapt_", this.$nodes = $("[data-da]"), this.$nodes.length > 0 && this.init() } init() { this.$nodes.each((e, t) => { const s = $(t), n = s.data("da").trim().split(","), i = {}; i.element = s, i.parent = s.parent(), i.destination = $(n[0].trim()), i.breakpoint = n[1] ? n[1].trim() : "767", i.place = n[2] ? n[2].trim() : "last", i.index = this.indexInParent(i.parent, i.element), this.objects.push(i) }), this.arraySort(this.objects), this.mediaQueries = this.objects.map(e => `(${this.type}-width: ${e.breakpoint}px),${e.breakpoint}`).filter((e, t, s) => s.indexOf(e) === t), this.mediaQueries.forEach(e => { const t = e.split(","), s = window.matchMedia(t[0]), n = t[1], i = this.objects.filter(e => e.breakpoint === n); s.addEventListener("change", () => { this.mediaHandler(s, i) }), this.mediaHandler(s, i) }) } mediaHandler(e, t) { e.matches ? t.forEach(e => { e.index = this.indexInParent(e.parent, e.element), this.moveTo(e.place, e.element, e.destination) }) : t.forEach(e => { e.element.hasClass(this.daClassname) && this.moveBack(e.parent, e.element, e.index) }) } moveTo(e, t, s) { t.addClass(this.daClassname); const n = s.children(); "last" === e || e >= n.length ? s.append(t) : "first" !== e ? n.eq(e).before(t) : s.prepend(t) } moveBack(e, t, s) { t.removeClass(this.daClassname); const n = e.children(); n.eq(s).length > 0 ? n.eq(s).before(t) : e.append(t) } indexInParent(e, t) { return e.children().index(t) } arraySort(e) { "min" === this.type ? e.sort((e, t) => e.breakpoint === t.breakpoint ? e.place === t.place ? 0 : "first" === e.place || "last" === t.place ? -1 : "last" === e.place || "first" === t.place ? 1 : e.place - t.place : e.breakpoint - t.breakpoint) : e.sort((e, t) => e.breakpoint === t.breakpoint ? e.place === t.place ? 0 : "first" === e.place || "last" === t.place ? 1 : "last" === e.place || "first" === t.place ? -1 : t.place - e.place : t.breakpoint - e.breakpoint) } }("max") }) })();